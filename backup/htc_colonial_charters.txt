# scope:actor = country, scope:recipient = country
 
REPLACE:create_colonial_charter = {
	type = owncountry
	
	potential = {
		scope:actor = {
			num_provinces > 0
			is_rebel_country = no
			NOT = { country_type = building }
			modifier:can_colonize = yes
			OR = {
				is_ai = no 
				ai_country_should_colonize = yes
			}
		}
	}

	allow = {
		scope:actor = {
			total_population >= 5
		}
	}

	ai_tick = monthly
	ai_tick_frequency = 6
	automation_tick = monthly
	automation_tick_frequency = 1

	player_automated_category = colonies

	
	price = price:create_colonial_charter
	
	select_trigger = {
		top_widget = colony_item_card_at_province_select
		looking_for_a = province_definition
		source = actor
		source_flags = possible_colonial_charters
		target_flag = target
		cache_targets = yes #these are the same no matter where we're coming from
		name = "create_colonial_charter_select_province_definition"
		none_available_msg_key = "create_colonial_charter_no_provinces"
		column = {
			data = colonial_charter
		}
		#no trigger, possible_colonial_charters does province for us in code
		enabled = {
			scope:actor = {
				
				custom_tooltip = {
					text = settle_the_frontier_ct
					not = {
						any_cabinet = {
							has_cabinet_action = yes
							cabinet_action = cabinet_action:settle_the_frontier
							interaction_target:target = root
						}
					}
				}
			}
		}
	}

	select_trigger = {
		default_sort = population
		top_widget = colony_item_card_at_province_select
		looking_for_a = province
		source = actor
		target_flag = source
		cache_targets = yes #always the same set
		pre_evaluation_sort_value = {
			value = population
		}
		pre_evaluation_number_to_evaluate_fully = 5
		max_targets_for_ui = 100 #big countries really punish the UI
		name = "create_colonial_charter_select_province"
		none_available_msg_key = "create_colonial_charter_select_province_none"
		column = {
			data = create_colonial_charter_column
		}
		column = {
			data = population
		}
		enabled = {
			population > 1
		}
	}
 
	effect = {
		scope:actor = {
			if = {
				limit = {
					exists = scope:source
					exists = scope:target
				}
				create_colonial_charter = {
					source = scope:source
					target = scope:target
				}
			}
		}
	}

	ai_will_do = {
		if = {
			limit = {
				scope:actor ={
					is_colonial_subject = yes
				}
			}
            add = "scope:actor.colonial_charter_utility(scope:target|scope:source)"
		}
		if = {
            limit = {
                scope:actor = {
                    or = {
                        tag = POR
                    }
                }
                or = {
                    scope:target = province_definition:azores_province
                    scope:target = province_definition:madeira_province
                    scope:target = province_definition:canary_islands_province
                    scope:target = province_definition:cape_verde_province
                    scope:target = province_definition:guinean_coast_province
                    scope:target = province_definition:bonny_province
                    scope:target = province_definition:mbegela_province
                    scope:target = province_definition:ternate_province
                    scope:target = province_definition:timor_province
                    scope:target.area = area:kongo_area
                    scope:target = {
                        or = {
                            area = area:west_kongo_area
                            area = area:south_kongo_area
                            area = area:mozambique_area
                            area = area:ruvuma_lurio_area
                        }
                    }
                    scope:target = {
                        or = {
                            region = region:brazil_region
                            region = region:zimbabwe_region
                        }
                    }
                }
            }
            add = "scope:actor.colonial_charter_utility(scope:target|scope:source)"
            multiply = 2
        }
		if = {
			limit = {
                scope:actor = {
                    or = {
                        tag = CAS
                        tag = SPA
                    }
                }
				scope:target = {
					or = {
						region = region:colombia_region
						region = region:la_plata_region
						region = region:andes_region
						region = region:chaco_region
						region = region:caribbean_region
						region = region:central_america_region
						region = region:mesoamerica_region
						region = region:great_plains_region
						region = region:aridoamerica_region
						region = region:west_coast_region
					}
				}
			}
		}
        if = {
            limit = {
                scope:actor = {
                    or = {
                        tag = ENG
                        tag = GBR
                        tag = FRA
                    }
                }
				or = {
					scope:target = province_definition:bahamas_province
					scope:target = {
						or = {
							area = area:bermuda_area
							area = area:kru_area
							area = area:gold_coast_area
							region = region:canada_region
							region = region:east_coast_region
							region = region:great_plains_region
						}
					}
				}
            }
            add = "scope:actor.colonial_charter_utility(scope:target|scope:source)"
        }
        if = {
            limit = {
                scope:actor = {
                    or = {
                        tag = SWE
                        tag = NOR
                        tag = FIN
                    }
                }
				scope:target = {
					or = {
						region = region:scandinavian_region
					}
				}
            }
            add = "scope:actor.colonial_charter_utility(scope:target|scope:source)"
        }
	}
}
