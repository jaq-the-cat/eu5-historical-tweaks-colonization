REPLACE_OR_CREATE:estabilish_trade_post = {
	ability = dip
	potential = {
		is_rebel_country = no
		num_locations > 0
	}
	allow = {
		or = {
			is_ai = no
			has_or_had_tag = POR
			has_or_had_tag = CAS
			has_or_had_tag = SPA
			has_or_had_tag = FRA
			has_or_had_tag = ENG
			has_or_had_tag = GBR
			has_or_had_tag = NED
		}
		or = {
			# renaissance
			has_advance = por_pursuing_waves
			has_advance = route_to_the_indies_advance
			# discovery
			has_advance = coastal_trade_routes_advance
			# reformation
			has_advance = global_trade_routes_advance
		}
	}

	select_trigger = {
		looking_for_a = location
		interaction_source_list = {
			every_location_in_the_world = {
				limit = {
					is_coastal = yes
					is_ownable = yes
					or = {
						# atlantic
						this = location:bermuda
						this = location:st_helena
						# north africa
						this = location:bojador
						this = location:arguin
						# west africa
						this = location:bissagos
						trigger_if = {
							limit = { current_year > 1600 }
							or = {
								this = location:rio_grande # bolola
								this = location:rio_nunez # cacino
							}
						}
						this = location:banana_islands # madina
						this = location:cape_mount
						this = location:cabo_corso
						this = location:cabo_formoso
						# gulf of guinea
						this = location:sao_tome
						this = location:fernando_po
						# kongo
						this = location:cabinda_kongo
						this = location:luanda
						this = location:mbegela
						# south africa
						this = location:ezorongondo
						this = location:uri_ae_ona
						this = location:goringhaikona
						# east africa
						this = location:al_khadra
						this = location:sada
						this = location:fort_dauphin
						# indonesia
						region = region:indonesia_region
						# oceania
						continent = continent:oceania
					}
				}
				add_to_list = source
			}
		}
		target_flag = target
		cache_targets = yes
		name = "estabilish_trade_post_select_location"
		none_available_msg_key = "estabilish_trade_post_no_locations"
		column = { data = name }
		column = { data = population }
		visible = {
			not = { cabinet_already_performing_same_task_on_target = { cabinet_action = estabilish_trade_post interaction_target = target } }
			has_owner = no
			is_discovered_by = scope:actor
			within_colonial_range_of = scope:actor
		}
		enabled = {
			or = {
				continent = continent:africa
				not = { area = { any_location_in_area = { owner ?= scope:actor } } }
			}
		}
	}
	
	years = 1

	on_fully_activated = {
		if = {
			limit = { exists = scope:target }
			scope:target = {
				change_location_owner = scope:actor
				change_integration_level = colonized
			}
		}
	}

	on_activate = {}
	on_deactivate = {}

	is_finished = {
		or = {
			# finished implementing!
			cabinet_action:estabilish_trade_post = {
				is_fully_implemented_in = root
			}
			root = { has_owner = yes }
		}
	}
	progress = {
		cabinet_action:estabilish_trade_post = {
			value = "implementation_progress_percentage(scope:actor)"
		}
	}

	ai_will_do = {
		if = {
			limit = {
				scope:actor = {
					or = {
						# portugal and castille explore pre-1500
						has_or_had_tag = POR
						has_or_had_tag = CAS
						has_or_had_tag = SPA
						# france and england join in to explore post-1500
						and = {
							current_year >= 1500
							or = {
								has_or_had_tag = FRA
								has_or_had_tag = ENG
								has_or_had_tag = GBR
								has_or_had_tag = NED
							}
						}
					}
				}
			}
			add = 30
		}
		else = {
			add = -1000
		}
	}
}