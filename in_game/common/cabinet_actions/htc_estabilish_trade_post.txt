estabilish_trade_post = {
	ability = dip
	potential = {
		is_rebel_country = no
		num_locations > 0
	}
	allow = {
		or = {
			# renaissance
			has_advance = por_pursuing_waves
			has_advance = route_to_the_indies_advance
			# discovery
			has_advance = coastal_trade_routes_advance
			# reformation
			has_advance = global_trade_routes_advance
		}
	}

	select_trigger = {
		looking_for_a = region
		interaction_source_list = {
			every_region = {
				limit = {
					not = {
						any_location_in_region = {
							owner ?= scope:actor
						}
					}
					any_location_in_region = {
						has_owner = no
						is_ownable = yes
						is_coastal = yes
						is_discovered_by = scope:actor
					}
				}
				add_to_list = source
			}
		}
		target_flag = target_region
		name = "estabilish_trade_post_select_region"
		none_available_msg_key = "estabilish_trade_post_no_regions"
		column = { data = name }
		column = { data = population }
		visible = {
			not = { cabinet_already_performing_same_task_on_target = { cabinet_action = estabilish_trade_post interaction_target = target_region } }
		}
		enabled = {}
	}

	select_trigger = {
		looking_for_a = location
		source = target_region
		target_flag = target_location
		name = "estabilish_trade_post_select_location"
		none_available_msg_key = "estabilish_trade_post_no_locations"
		column = { data = name }
		column = { data = population }
		visible = {
			not = { cabinet_already_performing_same_task_on_target = { cabinet_action = estabilish_trade_post interaction_target = target_location } }
			is_discovered_by = scope:actor
			has_owner = no
			is_ownable = yes
			is_coastal = yes
		}
		enabled = {}
	}
	
	years = 1

	on_fully_activated = {
		scope:target_location = {
			change_location_owner = scope:actor
			change_integration_level = colonized
		}
	}

	on_activate = {}
	on_deactivate = {}

	is_finished = {
		or = {
			# finished implementing!
			cabinet_action:estabilish_trade_post = {
				is_fully_implemented_in = root
			}
			# we already own a location in that region
			scope:target_region = {
				any_location_in_region = {
					owner ?= scope:actor
				}
			}
		}
	}
	progress = {
		cabinet_action:estabilish_trade_post = {
			value = "implementation_progress_percentage(scope:actor)"
		}
	}

	ai_will_do = {
		if = {
			limit = {
				scope:actor = {
					or = {
						# portugal and castille explore pre-1500
						and = {
							current_year < 1500
							or = {
								has_or_had_tag = POR
								has_or_had_tag = CAS
								has_or_had_tag = SPA
							}
						}
						# france and england join in to explore post-1500
						and = {
							current_year >= 1500
							or = {
								has_or_had_tag = POR
								has_or_had_tag = CAS
								has_or_had_tag = SPA
								has_or_had_tag = FRA
								has_or_had_tag = ENG
								has_or_had_tag = GBR
							}
						}
					}
				}
				scope:target_region = {
					or = {
						this = region:indonesia_region
						this = region:melanesia_region
						this = region:new_zealand_region
						continent = continent:africa
						sub_continent = sub_continent:pacific_islands
					}
					any_location_in_region = {
						not = { owner ?= scope:actor }
					}
				}
			}
			add = 1000
		}
		else = {
			add = -1000
		}
	}
}