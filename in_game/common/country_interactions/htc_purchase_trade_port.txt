purchase_trade_port = {
	type = diplomacy
	category = CATEGORY_ECONOMY_ACTIONS

	ai_tick = daily
	ai_tick_frequency = 360

	potential = {
		scope:actor = {
			or = {
				is_ai = no
				has_or_had_tag = POR
				has_or_had_tag = CAS
				has_or_had_tag = SPA
				has_or_had_tag = FRA
				has_or_had_tag = ENG
				has_or_had_tag = GBR
				has_or_had_tag = NED
			}
		}
	}

	cooldown = { 
		type = purchase_trade_port
		years = 5
	}

	allow = {}
	
	select_trigger = {
		looking_for_a = country
		target_flag = recipient
		ai_interaction_source_list = {
			every_country = {
				capital = {
					or = {
						sub_continent = sub_continent:south_asia
						sub_continent = sub_continent:east_asia
						region = region:indonesia_region
						region = region:melanesia_region
					}
				}
				add_to_list = source
			}
		}
		name = "choose_country"
		column = {
			data = name
		}
		visible = {
			scope:recipient = {
				capital = {
					or = {
						sub_continent = sub_continent:south_asia
						sub_continent = sub_continent:east_asia
						region = region:indonesia_region
						region = region:melanesia_region
					}
				}
			}
		}
        enabled = {
			scope:recipient = {
				at_war = no
				not = {
					any_neighbor_location = {
						owner = scope:actor
					}
				}
			}
		}
	}

	select_trigger = {
		looking_for_a = location
		source = recipient
		target_flag = trade_port_location
		name = "purchase_trade_port_select_location"
		none_available_msg_key = "purchase_trade_port_no_locations"
		column = { data = name }
		column = { data = market }
		column = { data = development }
		default_sort = development
		visible = {
			is_coastal = yes
		}
		enabled = {}
	}

	ai_will_do = {
		if = {
			limit = {
				scope:actor = {	
					gold > {
						value = scope:recipient.country_tax_base
						add = {
							value = scope:trade_port_location.development
							multiply = 5
						}
						max = {
							value = scope:recipient.country_tax_base
							multiply = 4
						}
					}
				}
			}
			add = {
				value = 100
			}
		}
	}
	
	effect = {
        scope:recipient = {
			add_gold = {
				value = scope:recipient.country_tax_base
				add = {
					value = scope:trade_port_location.development
					multiply = 5
				}
				max = {
					value = scope:recipient.country_tax_base
					multiply = 4
				}
			}
			add_opinion_mutual_effect = {
				target = scope:actor
				modifier = opinion_traders_in_x
			}
		}
		scope:actor = {
			add_gold = {
				value = scope:recipient.country_tax_base
				add = {
					value = scope:trade_port_location.development
					multiply = 5
				}
				max = {
					value = scope:recipient.country_tax_base
					multiply = 4
				}
				multiply = -1
			}
			scope:trade_port_location = {
				change_location_owner = scope:actor
				change_integration_level = colonized
			}
		}
	}

	diplo_chance = {
		base = -25
		opinion = 0.5
		in_debt = 100
	}
}
