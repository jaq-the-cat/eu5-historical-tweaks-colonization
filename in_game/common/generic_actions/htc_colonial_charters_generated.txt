
REPLACE:create_colonial_charter = {
    type = owncountry
    
    potential = {
        scope:actor = {
            num_provinces > 0
            is_rebel_country = no
            NOT = { country_type = building }
            modifier:can_colonize = yes
            OR = {
                is_ai = no 
                ai_country_should_colonize = yes
            }
        }
    }

    allow = {
        scope:actor = {
            total_population >= 5
        }
    }

    ai_tick = monthly
    ai_tick_frequency = 6
    automation_tick = monthly
    automation_tick_frequency = 1

    player_automated_category = colonies
    
    price = price:create_colonial_charter
    
    select_trigger = {
        top_widget = colony_item_card_at_province_select
        looking_for_a = province_definition
        source = actor
        source_flags = possible_colonial_charters
        target_flag = target
        cache_targets = yes #these are the same no matter where we're coming from
        name = "create_colonial_charter_select_province_definition"
        none_available_msg_key = "create_colonial_charter_no_provinces"
        column = {
            data = colonial_charter
        }
        # no trigger, possible_colonial_charters does this for us in code
        # scope:actor = colonizer, root = province_definition
        enabled = {
            scope:actor = {
                is_valid_colonial_charter = prev
                custom_tooltip = {
                    text = settle_the_frontier_ct
                    not = {
                        any_cabinet = {
                            has_cabinet_action = yes
                            cabinet_action = cabinet_action:settle_the_frontier
                            interaction_target:target = root
                        }
                    }
                }
            }
            custom_tooltip = {
                text = htc_colonial_charter_why
                scope:actor = {
                    or = {
                        # player
                        and = {
                            is_ai = no
                            root = {
                                any_location_in_province_definition = {
                                    adjacent_to_owned_by = scope:actor
                                }
                            }
                        }
                        # CNs
                        and = {
                            is_subject_type = colonial_nation
                            country_tax_base > 50
                            root.region = scope:actor.capital.region
                        }
                        # mesoamericans
                        and = {
                            religion.group = religion_group:tonal_group
                            root = {
                                any_location_in_province_definition = {
                                    adjacent_to_owned_by = scope:actor
                                }
                            }
                        }
                        # incans
                        and = {
                            religion = religion:inti
                            root.region = region:andes_region
                        }
                        # manchuria
                        and = {
                            has_or_had_tag = MCH
                            root.region = region:manchuria_region
                        }
                        # japan
                        and = {
                            or = {
                                has_or_had_tag = YMT
                                has_or_had_tag = JAP
                            }
                            root.continent = continent:asia
                        }
                        # russia early
                        and = {
                            culture = { has_culture_group = culture_group:russian_group }
                            or = {
                                root.sub_continent = sub_continent:eastern_europe
                            }
                        }
                        # russia late
                        and = {
                            current_year > 1500
                            culture = { has_culture_group = culture_group:russian_group }
                            or = {
                                root.sub_continent = sub_continent:north_asia
                                root.sub_continent = sub_continent:central_asia
                            }
                        }
                        # natives
                        and = {
                            not = { is_subject_type = colonial_nation }
                            or = {
                                # africa
                                has_or_had_tag = ETH
                                has_or_had_tag = KIT
                                and = {
                                    current_year > 1550
                                    has_or_had_tag = ZMW
                                }
                                and = {
                                    current_year > 1500
                                    has_or_had_tag = ZAN
                                }
                                 # kongo
                                and = {
                        		    religion = religion:bantu_religion
                                    capital.region = region:kongo_region
                                }
                            }
                        }
                        # scandinavia
                        and = {
                            or = {
                                has_or_had_tag = SWE
                                has_or_had_tag = NOR
                            }
                            root.region = region:scandinavian_region
                        }
                        # england
                        and = {
                            or = {
                                is_ai = no
                                has_or_had_tag = ENG
                                has_or_had_tag = GBR
                            }
                            root = {
                                or = {
                                    and = {
                                        current_year > 1520
                                        region = region:east_coast_region
                                    }
                                    and = {
                                        current_year > 1520
                                        region = region:canada_region
                                    }
                                    and = {
                                        current_year > 1540
                                        region = region:caribbean_region
                                    }
                                    and = {
                                        current_year > 1600
                                        region = region:aridoamerica_region
                                    }
                                    and = {
                                        current_year > 1600
                                        region = region:great_plains_region
                                    }
                                    and = {
                                        current_year > 1600
                                        region = region:west_coast_region
                                    }
                                }
                            }
                        }
                        # france
                        and = {
                            or = {
                                is_ai = no
                                has_or_had_tag = FRA
                            }
                            root = {
                                or = {
                                    and = {
                                        current_year > 1500
                                        this = province_definition:higuey_province
                                    }
                                    and = {
                                        current_year > 1550
                                        region = region:east_coast_region
                                    }
                                    and = {
                                        current_year > 1550
                                        region = region:canada_region
                                    }
                                    and = {
                                        current_year > 1550
                                        region = region:caribbean_region
                                    }
                                    and = {
                                        current_year > 1600
                                        region = region:great_plains_region
                                    }
                                    and = {
                                        current_year > 1600
                                        region = region:west_coast_region
                                    }
                                }
                            }
                        }
                        # portugal
                        and = {
                            or = {
                                is_ai = no
                                has_or_had_tag = POR
                            }
                            root = {
                                or = {
                                    and = {
                                        current_year > 1419
                                        this = province_definition:madeira_province
                                    }
                                    and = {
                                        current_year > 1427
                                        this = province_definition:azores_province
                                    }
                                    and = {
                                        current_year > 1458
                                        this = province_definition:cape_verde_province
                                    }
                                    and = {
                                        current_year > 1490
                                        area = area:gold_coast_area
                                    }
                                    and = {
                                        current_year > 1490
                                        this = province_definition:mascarene_islands_province
                                    }
                                    and = {
                                        current_year > 1500
                                        area = area:mozambique_area
                                    }
                                    and = {
                                        current_year > 1500
                                        area = area:pindorama_area
                                    }
                                    and = {
                                        current_year > 1500
                                        area = area:janeiro_area
                                    }
                                    and = {
                                        current_year > 1520
                                        region = region:brazil_region
                                    }
                                    and = {
                                        current_year > 1540
                                        area = area:pampa_area
                                    }
                                    and = {
                                        current_year > 1550
                                        area = area:west_kongo_area
                                    }
                                    and = {
                                        current_year > 1550
                                        region = region:zimbabwe_region
                                    }
                                }
                            }
                        }
                        # spain
                        and = {
                            or = {
                                is_ai = no
                                has_or_had_tag = CAS
                                has_or_had_tag = SPA
                            }
                            root = {
                                or = {
                                    and = {
                                        current_year > 1400
                                        this = province_definition:canary_islands_province
                                    }
                                    and = {
                                        current_year > 1500
                                        area = area:cuba_area
                                    }
                                    and = {
                                        current_year > 1500
                                        this = province_definition:marien_province
                                    }
                                    and = {
                                        current_year > 1500
                                        this = province_definition:jaragua_province
                                    }
                                    and = {
                                        current_year > 1500
                                        this = province_definition:magua_province
                                    }
                                    and = {
                                        current_year > 1500
                                        this = province_definition:maguana_province
                                    }
                                    and = {
                                        current_year > 1500
                                        this = province_definition:boriken_province
                                    }
                                    and = {
                                        current_year > 1520
                                        region = region:mesoamerica_region
                                    }
                                    and = {
                                        current_year > 1520
                                        region = region:colombia_region
                                    }
                                    and = {
                                        current_year > 1520
                                        region = region:la_plata_region
                                    }
                                    and = {
                                        current_year > 1520
                                        region = region:andes_region
                                    }
                                    and = {
                                        current_year > 1540
                                        area = area:florida_area
                                    }
                                    and = {
                                        current_year > 1540
                                        region = region:caribbean_region
                                    }
                                    and = {
                                        current_year > 1540
                                        region = region:central_america_region
                                    }
                                    and = {
                                        current_year > 1600
                                        region = region:chaco_region
                                    }
                                    and = {
                                        current_year > 1600
                                        region = region:aridoamerica_region
                                    }
                                    and = {
                                        current_year > 1600
                                        region = region:west_coast_region
                                    }
                                }
                            }
                        }
                        # western
                        and = {
                            or = {
                                is_ai = no
                                has_or_had_tag = POR
                                has_or_had_tag = CAS
                                has_or_had_tag = SPA
                                has_or_had_tag = ENG
                                has_or_had_tag = GBR
                                has_or_had_tag = FRA
                                has_or_had_tag = NED
                            }
                            root = {
                                or = {
                                    and = {
                                        current_year > 1500
                                        area = area:east_african_island_area
                                    }
                                    and = {
                                        current_year > 1550
                                        area = area:goringhaikona_area
                                    }
                                    and = {
                                        current_year > 1550
                                        area = area:mascarene_islands_area
                                    }
                                    and = {
                                        current_year > 1550
                                        region = region:indonesia_region
                                    }
                                    and = {
                                        current_year > 1550
                                        region = region:indochina_region
                                    }
                                    and = {
                                        current_year > 1600
                                        continent = continent:oceania
                                    }
                                    and = {
                                        current_year > 1650
                                        continent = continent:america
                                    }
                                    and = {
                                        current_year > 1700
                                        area = area:gold_coast_area
                                    }
                                    and = {
                                        current_year > 1700
                                        area = area:kru_area
                                    }
                                    and = {
                                        current_year > 1700
                                        area = area:upper_guinea_area
                                    }
                                    and = {
                                        current_year > 1700
                                        area = area:yoruba_area
                                    }
                                    and = {
                                        current_year > 1700
                                        area = area:benin_area
                                    }
                                    and = {
                                        current_year > 1700
                                        area = area:gulf_of_guinea_area
                                    }
                                    and = {
                                        current_year > 1700
                                        region = region:southern_africa_region
                                    }
                                    and = {
                                        current_year > 1700
                                        region = region:zimbabwe_region
                                    }
                                    and = {
                                        current_year > 1700
                                        region = region:swahili_coast_region
                                    }
                                    and = {
                                        current_year > 1700
                                        region = region:madagascar_region
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    effect = {
        scope:actor = {
            if = {
                limit = {
                    exists = scope:target
                }
                create_colonial_charter = {
                    target = scope:target
                }
            }
        }
    }

    ai_will_do = {
        add = "scope:actor.colonial_charter_utility(scope:target)"
        if = {
            limit = {
                scope:actor = {
				    monthly_balance > 25
                    or = {
                        capital.continent = continent:europe
                        is_subject_type = colonial_nation
                    }
                }
            }
            multiply = 10
        }
    }
}
