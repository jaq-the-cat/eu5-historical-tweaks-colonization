htc_coi_purchase_province = {
    type = situation
    show_message = no
    potential = {
        scope:actor = {
            capital ?= { continent = continent:europe }
        }
    }

    allow = {
        scope:actor = {
            at_war = no
        }
    }

    automation_tick = never
    automation_tick_frequency = 12
    ai_tick = monthly
    ai_tick_frequency = 6

    price = price:empty_unit_maintenance

    cooldown = {
        type = htc_coi_purchase_province_key
        years = 2
    }

    select_trigger = {
        looking_for_a = situation
        interaction_source_list = {
            situation:conquest_of_india = {
                add_to_list = source
            }
        }
        target_flag = recipient
        name = "choose_situation"
        column = {
            data = name
        }
        visible = {
            situation:conquest_of_india = this
            situation_is_active = yes
            # var:strongest_european_power = scope:actor
        }
    }

    select_trigger = {
        looking_for_a = province
        target_flag = target
        name = "choose_province"
        none_available_msg_key = "no_provinces_available"
        column = { data = owner_flag }
        column = { data = name }
        column = { data = population }
        visible = {
            sub_continent = sub_continent:south_asia
            root.owner = {
                culture = { has_culture_group = culture_group:indian_group }
            }
            province_average_control < 0.5
            or = {
                province_satisfaction < 0.5
                province_food_percentage < 0.5
            }
            any_location_in_province = {
                or = {
                    adjacent_to_owned_or_owned_by_subject = scope:actor
                    is_port = yes 
                }
            }
        }
    }
    effect = {
        scope:actor = {
            add_gold = {
                value = scope:target.province_tax_base
                multiply = 10
                max = {
                    value = scope:target.owner.country_tax_base
                    multiply = 5
                }
                multiply = -1
            }
        }
        scope:target.owner = {
            add_gold = {
                value = scope:target.province_tax_base
                multiply = 10
                max = {
                    value = scope:target.owner.country_tax_base
                    multiply = 5
                }
            }
        }
        scope:target = {
            every_location_in_province = {
                change_location_owner = scope:actor
            }
            # custom_tooltip = {
            #     text = htc_coi_purchase_province_tt
            #     scope:target = {
            #         trigger_event_non_silently = htc_conquest_of_india.4
            #     }
            # }
        }
    }

    ai_will_do = {
        value = -1
        if = {
            # has more gold than required to purchase
            limit = {
                scope:actor = {    
                    gold > {
                        value = scope:target.province_tax_base
                        multiply = 10
                        max = {
                            value = scope:target.owner.country_tax_base
                            multiply = 5
                        }
                    }
                }
            }
            add = scope:actor.societal_value:land_vs_naval
            add = {
                value = {
                    add =  scope:actor.societal_value:outward_vs_inward
                    multiply = -1
                }
            }
            if = {
                limit = { scope:actor.modifier:bias_for_colonialist_policies > 0 }
                add = scope:actor.modifier:bias_for_colonialist_policies
            }
            if = {
                limit = {
                    scope:target = {
                        not = {
                            any_location_in_province = {
                                adjacent_to_owned_or_owned_by_subject = scope:actor
                            }
                        }
                    }
                }
                divide = 4
            }
        }
    }
}

htc_coi_offer_protection = {
    type = situation
    show_message = no
    potential = {
        scope:actor = {
            capital ?= { continent = continent:europe }
        }
    }

    allow = {
        scope:actor = {
            at_war = no
        }
    }

    automation_tick = never
    automation_tick_frequency = 12
    ai_tick = monthly
    ai_tick_frequency = 6

    price = price:empty_unit_maintenance

    cooldown = {
        type = htc_coi_offer_protection_key
        years = 1
    }

    select_trigger = {
        looking_for_a = situation
        interaction_source_list = {
            situation:conquest_of_india = {
                add_to_list = source
            }
        }
        target_flag = recipient
        name = "choose_situation"
        column = {
            data = name
        }
        visible = {
            situation:conquest_of_india = this
            situation_is_active = yes
            # var:strongest_european_power = scope:actor
        }
    }

    select_trigger = {
        looking_for_a = country
        target_flag = target
        name = "choose_country"
        column = { data = name }
        column = { data = great_power_score }
        column = { data = population }
        visible = {
            culture = { has_culture_group = culture_group:indian_group }
            or = {
                and = {
                    is_subject = no
                    great_power_score <= {
                        value = scope:actor.great_power_score
                        divide = 2
                    }
                }
                and = {
                    is_subject = yes
                    top_overlord ?= {
                        capital ?= { continent = continent:europe }
                        great_power_score < {
                            value = scope:actor.great_power_score
                        }
                    }
                }
            }
        }
        enabled = {
            any_neighbor_country = {
                has_casus_belli_on = prev
            }
        }
    }

    effect = {
        scope:target = {
            make_subject_of = {
                target = scope:actor
                # TODO: custom subject type here with more autonomy than a vassal
                type = subject_type:vassal
            }   
        }
        # custom_tooltip = {
        #     text = htc_coi_offer_protection_tt
        #     scope:target = {
        #         trigger_event_non_silently = htc_conquest_of_india.5
        #     }
        # }
    }

    ai_will_do = {
        value = -1
        if = {
            limit = {
                scope:actor = {    
                    country_tax_base > {
                        value = scope:target.country_tax_base
                        multiply = 2
                    }
                }
            }
            add = scope:actor.societal_value:land_vs_naval
            add = {
                value = {
                    add = scope:actor.societal_value:outward_vs_inward
                    multiply = -1
                }
            }
            if = {
                limit = { scope:actor.modifier:bias_for_colonialist_policies > 0 }
                add = scope:actor.modifier:bias_for_colonialist_policies
            }
            if = {
                limit = {
                    scope:target = {
                        not = { is_neighbor_of = scope:actor }
                    }
                }
                divide = 4
            }
        }
    }
}

htc_coi_assist_in_war_for_vassal = {
    type = situation
    show_message = no
    potential = {
        scope:actor = {
            capital ?= { continent = continent:europe }
        }
    }

    allow = {
        scope:actor = {
            at_war = no
        }
    }

    automation_tick = never
    automation_tick_frequency = 12
    ai_tick = monthly
    ai_tick_frequency = 6

    price = price:empty_unit_maintenance

    cooldown = {
        type = htc_coi_assist_in_war_for_vassal_key
        months = 6
    }

    select_trigger = {
        looking_for_a = situation
        interaction_source_list = {
            situation:conquest_of_india = {
                add_to_list = source
            }
        }
        target_flag = recipient
        name = "choose_situation"
        column = {
            data = name
        }
        visible = {
            situation:conquest_of_india = this
            situation_is_active = yes
            # var:strongest_european_power = scope:actor
        }
    }

    select_trigger = {
        looking_for_a = country
        target_flag = target
        name = "choose_country"
        column = { data = name }
        column = { data = great_power_score }
        column = { data = population }
        visible = {
            culture = { has_culture_group = culture_group:indian_group }
            is_at_war = yes
        }
        enabled = {
            is_in_losing_war = yes
        }
    }
    
    effect = {
        scope:target = {
            make_subject_of = {
                target = scope:actor
                # TODO: custom subject type here (maybe)
                type = subject_type:vassal
            }
        }
        # custom_tooltip = {
        #     text = htc_coi_assist_in_war_for_vassal_tt
        #     scope:target = {
        #         trigger_event_non_silently = htc_conquest_of_india.6
        #     }
        # }
    }

    ai_will_do = {
        add = -1 # ai is a bit too dumb for overseas war
    }
}